<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TABS lore</title>
  <link rel="stylesheet" href="css/main.css">
</head>
<body>

    <script type = "module">
      import * as THREE from 'https://threejsfundamentals.org/threejs/resources/threejs/r119/build/three.module.js';
      import {GLTFLoader} from 'https://threejsfundamentals.org/threejs/resources/threejs/r119/examples/jsm/loaders/GLTFLoader.js';

      var scene = new THREE.Scene();
      var camera = new THREE.PerspectiveCamera(30,window.innerWidth/window.innerHeight,0.1,1000);
      camera.position.z = 5;
      camera.position.y = 1;

      

      var renderer = new THREE.WebGLRenderer({antialias: true});
      renderer.setClearColor('#050505');
      renderer.setSize( window.innerWidth, window.innerHeight );

      document.body.appendChild( renderer.domElement );
      window.addEventListener('resize', () => 
      {
        renderer.setSize( window.innerWidth, window.innerHeight );
        camera.aspect = window.innerWidth/window.innerHeight;

        camera.updateProjectionMatrix();
        requestAnimationFrame(render);
      })

      var wobblerMesh;
      var wobbler;
      /*
      var objLoader = new THREE.OBJLoader();
      objLoader.load('models/wobbler.obj', function (object)
      {
        wobbler = object;
        //wobbler.material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
        scene.add(wobbler);
      }); 
      */

      const loader = new THREE.TextureLoader();
      const gltfLoader = new GLTFLoader();
      gltfLoader.load('models/wobbler.gltf', (gltf) => {
        wobbler = gltf.scene;
        wobbler.scale.x = 100;
        wobbler.scale.y = 100;
        wobbler.scale.z = 100;

        wobbler.rotation.x = -1.57;

        var newMat = new THREE.MeshBasicMaterial( {color: "#ffffff",} );

        wobbler.traverse((o) => 
        {
          if(o.isMesh)o.material = newMat;
        });
        scene.add(wobbler);
      });

      var x;
      var y;

      var tex = loader.load('textures/cross.png');
      tex.magFilter = THREE.NearestFilter;
      var mat = new THREE.MeshBasicMaterial( {color: "#ffffff", map: tex, alphaMap: tex, transparent: true, opacity: 0.5} );

      for (x = 0; x < 6; x++) 
      {
        for (y = 0; y < 5; y++) 
        {
          var geometry = new THREE.PlaneGeometry( .1, .1, 1 );
          var plane = new THREE.Mesh( geometry, mat );
          plane.position.z = -5;
          plane.position.x = x - 2.5;
          plane.position.y = y - 1;
          scene.add( plane );
        }
      }


      var light = new THREE.PointLight( '#ffffff', 1, 100 );
      light.position.set( 20, 5, 10 );
      scene.add( light );
      
      let then = 0;
      var render = function(now)
      {
        now *= 0.001;

        const delta = now - then;
        then = now;

        if(wobbler)
        {
          wobbler.rotation.z += 3  * delta;
        }
        requestAnimationFrame(render);
        renderer.render(scene, camera);
      };

      requestAnimationFrame(render);

    </script>
</body>
</html>